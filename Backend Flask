from flask import Flask, render_template, request, jsonify
import mysql.connector

app = Flask(__name__)

# Configuration de la base de donn√©es MySQL
db_config = {
    'user': 'root',
    'password': 'password',
    'host': 'localhost',
    'database': 'votes'
}

# Route principale pour servir la page HTML
@app.route('/')
def index():
    return render_template('1page.html')

# Route pour soumettre un vote
@app.route('/submit-vote', methods=['POST'])
def submit_vote():
    data = request.json
    location = data.get('location')
    criteria = data.get('criteria', [])
    
    if len(criteria) != 5:
        return jsonify({'error': 'Invalid criteria data'}), 400

    try:
        conn = mysql.connector.connect(**db_config)
        cursor = conn.cursor()
        sql = """
            INSERT INTO votes (location, criteria1, criteria2, criteria3, criteria4, criteria5) 
            VALUES (%s, %s, %s, %s, %s, %s)
        """
        cursor.execute(sql, (location, *criteria))
        conn.commit()
        cursor.close()
        conn.close()
        return jsonify({'message': 'Vote saved successfully!'})
    except mysql.connector.Error as err:
        return jsonify({'error': str(err)}), 500

if __name__ == '__main__':
    app.run(debug=True)
